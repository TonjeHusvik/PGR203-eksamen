<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kristiania Survey</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://images-ext-1.discordapp.net/external/5Dyxl8e4LJE8aOYhwsYt1owieCyW89R0m-Axi-DlISE/%3Fb%3D1%26k%3D20%26m%3D930353718%26s%3D170x170%26h%3DTXlZRdTq9UFiBoz611KTNJ0MBd2qh1qaAPr1bVPRw3E%3D/https/media.istockphoto.com/vectors/arts-flat-design-school-supplies-icon-with-side-shadow-vector-id930353718?width=153&height=153" rel="icon" type="image/x-icon"/>
</head>
<body onload="checkCookie()">
    <h1>Questionnaire</h1>

    <div id="cookieDiv">
    <form action="/api/setCookie" method="post" id="personInfo">
        <p>Please enter your information below.</p>
        <input class="field" type="text" id="firstName" placeholder="first name" style="text-transform: capitalize;" autofocus><br>
        <input class="field" type="text" id="lastName" name="lastName" placeholder="last name" style="text-transform: capitalize;"><br>
        <input class="field" type="email" id="email" name="email" placeholder="name@email.com"><br>
        <input class="field" type="number" id="professionId" name="professionId" placeholder="profession id"><br>
        <input class="field" type="number" id="workplaceId" name="workplaceId" placeholder="workplace id"><br><br>

        <button type="submit" onclick="setCookie('firstName')">Submit</button><br>
    </form>
    </div>

    <form method="POST" action="/api/newAnswer" id="questions">
    </form>
    
    <div>
        <a href="newQuestion.html">Add new question</a><br>
        <a href="addOption.html">Add options</a><br>
        <a href="showAnswers.html">Show all answers</a><br>
        <a href="editSurvey.html">Edit survey</a>
    </div>
</body>

<script>

    let today = new Date();
    let expiry = new Date(today.getTime() + 24 * 60 * 60 * 1000);

    function setCookie(firstName) {
        let firstNameValue = document.getElementById(firstName).value;

        document.cookie = firstName + "=" + firstNameValue + "; path=/; expires=" + expiry.toUTCString();
    }

    function getCookie(firstName) {
        let re = new RegExp(firstName + "=([^;]+)");
        let value = re.exec(document.cookie);
        return value[1];
    }

    function checkCookie() {
        let firstName = getCookie("firstName");
        if (firstName !== "" || firstName != null) {
            document.getElementById("cookieDiv").innerHTML = "<p>Welcome, " + firstName + "!</p>";
        }
    }

    fetch("/api/question")
    .then(function(response){
        return response.text();
    }).then(function(text){
        document.getElementById("questions").innerHTML = text;
    });

</script>
</html>