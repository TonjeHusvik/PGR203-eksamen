<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kristiania Survey</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="../../../images/icon.png" sizes="32x32"/>
</head>
<body onload="checkCookie()">
    <h1>Questionnaire</h1>
    <!--
    <form method="POST" action="/api/setCookie" id="setCookie"> onsubmit="checkCookie()"
        <label>Hi! Whats your name?<br><input type="text" id="cookieName" name="cookieName" placeholder="Enter your first name" /></label>
        <button type="submit">OK</button>
    </form>-->

    <div id="cookieField">
    <form action="/api/setCookie" method="post" id="personInfo">
        <input class="field" type="text" id="firstName" name="first-name" placeholder="first name" style="text-transform: capitalize;" autofocus><br>
        <input class="field" type="text" id="lastName" name="last-name" placeholder="last name" style="text-transform: capitalize;"><br>
        <input class="field" type="email" id="email" name="email" placeholder="name@email.com"><br>
        <input class="field" type="number" id="professtionId" name="profession-id" placeholder="1"><br>
        <input class="field" type="number" id="workplaceId" name="workplace-id" placeholder="2"><br><br>

        <button id="submitButton" onclick="setCookie('firstName', 'firstNameId', 'lastName', 'lastNameId', 'email', 'emailId', 'profession', 'professionId', 'workplace', 'workplaceId')" type="submit">set Cookie email</button><br>
    </form>
    </div>

    <form method="POST" action="/api/newAnswer" id="questions">

    </form>
    
    <div>
        <a href="newQuestion.html">Add new question</a><br>
        <a href="addOption.html">Add options</a><br>
        <a href="showAnswers.html">Show all answers</a><br>
        <a href="editSurvey.html">Edit survey</a>
    </div>
</body>

<script>

    let today = new Date();
    let expiry = new Date(today.getTime() + 30 * 24 * 3600 * 1000); // plus 30 days

    function setCookie(firstName, firstNameId, lastName, lastNameId, email, emailId, profession, professionId, workplace, workplaceId) {
        let firstNameValue = document.getElementById(firstName.value);
        let lastNameValue = document.getElementById(lastName.value);
        let emailValue = document.getElementById(email.value);
        let professionValue = document.getElementById(professionId.value);
        let workplaceValue = document.getElementById(workplaceId.value);

        document.cookie = firstName + "=" + firstNameValue + "; path=/; expires=" + expiry.toUTCString();
        document.cookie = lastName + "=" + lastNameValue + "; path=/; expires=" + expiry.toUTCString();
        document.cookie = email + "=" + emailValue + "; path=/; expires=" + expiry.toUTCString();
        document.cookie = profession + "=" + professionValue + "; path=/; expires=" + expiry.toUTCString();
        document.cookie = workplace + "=" + workplaceValue + "; path=/; expires=" + expiry.toUTCString();

        console.log(document.cookie);
    }

    function storeValues(form) {
        setCookie("email", form.email - field.value);
        return true;
    }

    function getCookie(name) {
        var re = new RegExp(name + "=([^;]+)");
        var value = re.exec(document.cookie);
        return (value != null) ? unescape(value[1]) : null;
    }

    function checkCookie() {
        let user = getCookie("firstName");
        if (user != "") {
            document.getElementById("cookieField").innerHTML = "<p>Welcome back " + user + "!</p>";
        } else {
            user = prompt("Please enter your name:", "");
            if (user != "" && user != null) {
                setCookie("cookiename", user, 365);
            }
        }
    }









    /*
    function setCookie(cookieName, cookieValue, expireDays) {
        const date = new Date();
        date.setTime(date.getTime() + (expireDays * 24 * 60 * 60 * 1000));
        let expires = "expires="+date.toUTCString();
        document.cookie = cookieName + "=" + cookieValue + ";" + expires + ";path=/";
    }
    */

    /*
    function getCookie(cookieName) {
        let name = cookieName + "=";
        let ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
    */

    /*const form = document.getElementById('setCookie');
    form.addEventListener('submit', (event) =>{
        //gj√∏re noe greier her med cookies
        var nameValue = document.getElementById("cookieName").value;
        return nameValue;
    });*/

    fetch("/api/question")
    .then(function(response){
        return response.text();
    }).then(function(text){
        document.getElementById("questions").innerHTML = text;
    });

</script>
</html>